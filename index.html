<!-- UPDATED VERSION WITH DASHBOARD + UNSTAKE -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>L3G3NDARY Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { background:#0b0b0f; color:#fff; font-family:Arial; margin:0; padding:20px }
    h1,h2 { color:#00ffd5 }
    .section { border:1px solid #222; border-radius:12px; padding:20px; margin-bottom:30px }
    button { background:#00ffd5; border:none; padding:10px 15px; margin:5px; cursor:pointer; border-radius:6px }
    input { padding:8px; margin:5px; background:#111; color:#fff; border:1px solid #333; border-radius:6px }
    .card { background:#111; padding:15px; border-radius:10px; margin-top:10px }
  </style>
</head>
<body>
<h1>L3G3NDARY Web3 Dashboard</h1>
<button onclick="connect()">Connect Wallet</button>
<p id="wallet"></p>

<div class="section">
<h2>L3G3NDARY Pass — Dashboard</h2>
<div class="card" id="passStakes"></div>
<input id="passTokenId" placeholder="Token ID">
<input id="passAmount" placeholder="Amount">
<button onclick="stakePass()">Stake</button>
<button onclick="claimPass()">Claim Rewards</button>
</div>

<div class="section">
<h2>L3G3NDS — Dashboard</h2>
<div class="card" id="l3ndsStakes"></div>
<input id="l3ndsTokenId" placeholder="Token ID">
<input id="l3ndsAmount" placeholder="Amount">
<button onclick="stakeL3nds()">Stake</button>
<button onclick="claimL3nds()">Claim Rewards</button>
</div>

<script>
let provider, signer, user;

const PASS_STAKING = "0xd6155A5dAb72E332A29574c1f6C56F8ba7EF1378";
const L3NDS_STAKING = "0x3E80ab8077dE0B6ccB28365e152440C4ED9Caa52";

const STAKING_ABI = [
  "function stake(uint256 tokenId,uint256 amount)",
  "function unstake(uint256 index)",
  "function claimRewards()",
  "function getUserStakes(address) view returns (tuple(uint256 tokenId,uint256 amount,uint256 stakedAt)[])"
];

async function connect() {
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  user = await signer.getAddress();
  document.getElementById('wallet').innerText = user;
  loadDashboards();
}

async function loadDashboards() {
  await loadStakes(PASS_STAKING, 'passStakes');
  await loadStakes(L3NDS_STAKING, 'l3ndsStakes');
}

async function loadStakes(address, elementId) {
  const c = new ethers.Contract(address, STAKING_ABI, provider);
  const stakes = await c.getUserStakes(user);
  let html = "";
  stakes.forEach((s, i) => {
    html += `<p>#${i} | tokenId: ${s.tokenId} | amount: ${s.amount} <button onclick=\"unstake('${address}',${i})\">Unstake</button></p>`;
  });
  document.getElementById(elementId).innerHTML = html || 'No stakes';
}

async function unstake(address, index) {
  const c = new ethers.Contract(address, STAKING_ABI, signer);
  await c.unstake(index);
}

async function stakePass() {
  const c = new ethers.Contract(PASS_STAKING, STAKING_ABI, signer);
  await c.stake(passTokenId.value, passAmount.value);
}

async function stakeL3nds() {
  const c = new ethers.Contract(L3NDS_STAKING, STAKING_ABI, signer);
  await c.stake(l3ndsTokenId.value, l3ndsAmount.value);
}

async function claimPass() {
  const c = new ethers.Contract(PASS_STAKING, STAKING_ABI, signer);
  await c.claimRewards();
}

async function claimL3nds() {
  const c = new ethers.Contract(L3NDS_STAKING, STAKING_ABI, signer);
  await c.claimRewards();
}
</script>
</body>
</html>
